---
// No imports ni lógica extra - solo en español

// Datos de los proyectos
const ProjectData = [
  {
    media: "https://res.cloudinary.com/drwacbtjf/video/upload/v1744662640/escalera_v9srkj.mp4",
    gallery: [
      "https://res.cloudinary.com/drwacbtjf/video/upload/v1744662640/escalera_v9srkj.mp4",
    ],
  },
  {
    media: "https://res.cloudinary.com/drwacbtjf/video/upload/v1744663142/cocina_e7ky1r.mp4",
    gallery: [
      "https://res.cloudinary.com/drwacbtjf/video/upload/v1744663142/cocina_e7ky1r.mp4",
    ],
  },
  {
    media: "https://res.cloudinary.com/drwacbtjf/image/upload/v1744662421/vinyll_samvcc.jpg",
    gallery: [
      "https://res.cloudinary.com/drwacbtjf/video/upload/v1744663145/dormitorio_kp6y0h.mp4",
    ],
  },
  {
    media: "https://res.cloudinary.com/drwacbtjf/video/upload/v1745276664/pr2_ssmtbp.mp4",
    gallery: [
      "https://res.cloudinary.com/drwacbtjf/video/upload/v1745276664/pr2_ssmtbp.mp4",
    ],
  },
  {
    media: "https://res.cloudinary.com/drwacbtjf/image/upload/v1744642984/Imagen_de_WhatsApp_2025-02-06_a_las_18.37.02_bbfa3f27_fjlv4i.jpg",
    gallery: [
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744642984/Imagen_de_WhatsApp_2025-02-06_a_las_18.37.02_bbfa3f27_fjlv4i.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744642983/Imagen_de_WhatsApp_2025-02-06_a_las_18.37.02_92c8953b_lii0qy.jpg",
    ],
  },
  {
    media: "https://res.cloudinary.com/drwacbtjf/image/upload/v1744643048/Imagen_de_WhatsApp_2025-02-06_a_las_18.38.35_b7203bd4_c2rls3.jpg",
    gallery: [
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744643048/Imagen_de_WhatsApp_2025-02-06_a_las_18.38.35_b7203bd4_c2rls3.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744643047/Imagen_de_WhatsApp_2025-02-06_a_las_18.38.35_b02fcae3_grx7xs.jpg",
    ],
  },
  {
    media: "https://res.cloudinary.com/drwacbtjf/image/upload/v1745097621/4_ek8c4k.png",
    gallery: [
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744643166/Imagen_de_WhatsApp_2025-02-06_a_las_18.38.14_faf1dc6f_l12fpq.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744643163/Imagen_de_WhatsApp_2025-02-06_a_las_18.38.14_d8b9052b_jxynww.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744643161/Imagen_de_WhatsApp_2025-02-06_a_las_18.38.14_ca896a48_pulng6.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744643158/Imagen_de_WhatsApp_2025-02-06_a_las_18.38.14_023dbe16_evzf0o.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744643104/Imagen_de_WhatsApp_2025-02-06_a_las_18.38.13_aed9433d_yvtlkt.jpg",
    ],
  },
  {
    media: "https://res.cloudinary.com/drwacbtjf/image/upload/v1744643209/Imagen_de_WhatsApp_2025-02-06_a_las_18.36.59_4daa45f6_vv0x0c.jpg",
    gallery: [
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744643214/Imagen_de_WhatsApp_2025-02-06_a_las_18.37.00_7f79daf0_wp0lxr.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744643212/Imagen_de_WhatsApp_2025-02-06_a_las_18.36.59_ebb514c7_gqgc9b.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744643210/Imagen_de_WhatsApp_2025-02-06_a_las_18.36.59_dd65ee00_jx5sxd.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744643209/Imagen_de_WhatsApp_2025-02-06_a_las_18.36.59_4daa45f6_vv0x0c.jpg",
    ],
  },
  {
    media: "https://res.cloudinary.com/drwacbtjf/image/upload/v1744663815/banio4_ua07hp.jpg",
    gallery: [
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744663815/banio4_ua07hp.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744663812/banio3_c5gwwl.jpg",
    ],
  },
  {
    media: "https://res.cloudinary.com/drwacbtjf/image/upload/v1744674993/Imagen_de_WhatsApp_2025-04-14_a_las_20.04.08_a4c2d3b4_wl8w8i.jpg",
    gallery: [
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744674993/Imagen_de_WhatsApp_2025-04-14_a_las_20.04.08_a4c2d3b4_wl8w8i.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744674993/Imagen_de_WhatsApp_2025-04-14_a_las_20.04.05_7840b89b_pfqgzk.jpg",
    ],
  },
  {
    media: "https://res.cloudinary.com/drwacbtjf/image/upload/v1745094934/Dise%C3%B1o_sin_t%C3%ADtulo_4_vuqym9.png",
    gallery: [
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744675027/Imagen_de_WhatsApp_2025-04-14_a_las_20.04.13_bae7abbe_o96oax.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744675027/Imagen_de_WhatsApp_2025-04-14_a_las_20.04.17_433f69f2_cdfjd7.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744675027/Imagen_de_WhatsApp_2025-04-14_a_las_20.04.16_1a211a31_cdeqsp.jpg",
    ],
  },
  {
    media: "https://res.cloudinary.com/drwacbtjf/image/upload/v1745094213/1_f6znxe.png",
    gallery: [
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744675070/Imagen_de_WhatsApp_2025-04-14_a_las_20.04.31_9e382741_phtr4q.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744675070/Imagen_de_WhatsApp_2025-04-14_a_las_20.04.31_fb81321e_uxt3mx.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744675071/Imagen_de_WhatsApp_2025-04-14_a_las_20.04.32_fc8e0d63_cjcmgl.jpg",
    ],
  },
  {
    media: "https://res.cloudinary.com/drwacbtjf/image/upload/v1744675109/Imagen_de_WhatsApp_2025-04-14_a_las_20.14.25_fa2bc361_bdefe4.jpg",
    gallery: [
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744675109/Imagen_de_WhatsApp_2025-04-14_a_las_20.14.25_fa2bc361_bdefe4.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744675110/Imagen_de_WhatsApp_2025-04-14_a_las_20.14.25_fa7f6a53_kjxlrc.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744675108/Imagen_de_WhatsApp_2025-04-14_a_las_20.14.25_c71e2992_oqfmio.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744675107/Imagen_de_WhatsApp_2025-04-14_a_las_20.14.25_126293c1_qy1sla.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744675106/Imagen_de_WhatsApp_2025-04-14_a_las_20.14.25_40f6e649_g5ehxp.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744675106/Imagen_de_WhatsApp_2025-04-14_a_las_20.14.25_9e29aa50_uoudnr.jpg",
    ],
  },
  {
    media: "https://res.cloudinary.com/drwacbtjf/image/upload/v1745097993/5_bdtckd.png",
    gallery: [
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744643154/Imagen_de_WhatsApp_2025-02-06_a_las_18.37.00_737de658_ioa8xa.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744643156/Imagen_de_WhatsApp_2025-02-06_a_las_18.37.00_43204dc8_aahfpf.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744676528/Imagen_de_WhatsApp_2025-02-06_a_las_18.37.03_d1982d0b_ocvnxg.jpg",
    ],
  },
  {
    media: "https://res.cloudinary.com/drwacbtjf/image/upload/v1745094622/3_ejo920.png",
    gallery: [
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744676757/Imagen_de_WhatsApp_2025-02-06_a_las_18.37.01_9315ec07_mki94l.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744676759/Imagen_de_WhatsApp_2025-02-06_a_las_18.37.02_0538fda0_oieu17.jpg",
      "https://res.cloudinary.com/drwacbtjf/image/upload/v1744643217/Imagen_de_WhatsApp_2025-02-06_a_las_18.37.02_baf7fdf1_gtdmrr.jpg",
    ],
  },
];
---

<section id="project-section" class="projects-section" data-aos="fade-up">
  <h2 class="text-center mb-4" data-aos="fade-up" data-aos-delay="100">Nuestros Proyectos</h2>
  <div class="project-gallery" data-aos="fade-up" data-aos-delay="200">
    {ProjectData.map((project, index) => {
      const isVideo = project.media.endsWith(".mp4");
      return (
        <div
          class="project-item"
          data-gallery={JSON.stringify(project.gallery)}
          data-index={index}
          data-aos="fade-up"
          data-aos-delay={300 + index * 100}
        >
          {isVideo ? (
            <video
              src={project.media}
              class="project-thumbnail"
              muted
              loop
              playsinline
            />
          ) : (
            <img src={project.media} alt="Proyecto" />
          )}
        </div>
      );
    })}
  </div>
</section>

<script>
  // Definir el componente modal si no está definido
  if (!customElements.get('project-modal')) {
    class ProjectModal extends HTMLElement {
      constructor() {
        super();
        this.attachShadow({ mode: 'open' });
      }

      connectedCallback() {
        const gallery = JSON.parse(this.getAttribute('gallery') || '[]');
        const currentIndex = parseInt(this.getAttribute('current-index') || '0');
        let currentGalleryIndex = 0;

        const modal = document.createElement('div');
        modal.className = 'project-modal';
        modal.innerHTML = `
          <div class="modal-content">
            <button class="close-button">&times;</button>
            <button class="nav-button prev-button">&lt;</button>
            <button class="nav-button next-button">&gt;</button>
            <div class="modal-gallery"></div>
          </div>
        `;

        const style = document.createElement('style');
        style.textContent = `
          .project-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
          }

          .modal-content {
            position: relative;
            width: 90%;
            height: 90%;
            display: flex;
            justify-content: center;
            align-items: center;
          }

          .close-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 30px;
            cursor: pointer;
            z-index: 1001;
          }

          .nav-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            padding: 10px 15px;
            cursor: pointer;
            z-index: 1001;
          }

          .prev-button {
            left: 20px;
          }

          .next-button {
            right: 20px;
          }

          .modal-gallery {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
          }

          .modal-gallery img,
          .modal-gallery video {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
          }
        `;

        this.shadowRoot?.appendChild(style);
        this.shadowRoot?.appendChild(modal);

        const modalGallery = this.shadowRoot?.querySelector('.modal-gallery');
        const closeButton = this.shadowRoot?.querySelector('.close-button');
        const prevButton = this.shadowRoot?.querySelector('.prev-button');
        const nextButton = this.shadowRoot?.querySelector('.next-button');

        const showMedia = (index) => {
          if (!modalGallery) return;
          const media = gallery[index];
          const isVideo = media.endsWith('.mp4');
          
          modalGallery.innerHTML = isVideo
            ? `<video src="${media}" controls autoplay></video>`
            : `<img src="${media}" alt="Gallery image" />`;
        };

        const nextMedia = () => {
          currentGalleryIndex = (currentGalleryIndex + 1) % gallery.length;
          showMedia(currentGalleryIndex);
        };

        const prevMedia = () => {
          currentGalleryIndex = (currentGalleryIndex - 1 + gallery.length) % gallery.length;
          showMedia(currentGalleryIndex);
        };

        closeButton?.addEventListener('click', () => {
          this.remove();
        });

        prevButton?.addEventListener('click', prevMedia);
        nextButton?.addEventListener('click', nextMedia);

        // Mostrar el primer elemento
        showMedia(currentGalleryIndex);

        // Cerrar con la tecla Escape
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            this.remove();
          }
        });

        // Cerrar al hacer clic fuera del contenido
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            this.remove();
          }
        });
      }
    }

    customElements.define('project-modal', ProjectModal);
  }

  // Manejar la apertura de la galería
  document.querySelectorAll('.project-item').forEach(card => {
    card.addEventListener('click', (e) => {
      const gallery = JSON.parse(card.getAttribute('data-gallery') || '[]');
      const index = parseInt(card.getAttribute('data-index') || '0');
      
      // Crear y configurar el modal
      const modal = document.createElement('project-modal');
      modal.setAttribute('gallery', JSON.stringify(gallery));
      modal.setAttribute('current-index', index.toString());
      
      // Asegurarnos de que el modal se agregue al body
      document.body.appendChild(modal);
    });
  });

  // Manejar la reproducción de videos
  document.querySelectorAll('video').forEach(video => {
    video.addEventListener('mouseenter', () => {
      video.play();
    });
    video.addEventListener('mouseleave', () => {
      video.pause();
      video.currentTime = 0;
    });
    video.addEventListener('contextmenu', (e) => {
      e.preventDefault();
    });
  });
</script>

<style>
.projects-section {
  padding: 4rem 0;
  background-color: var(--color-background, #f8f9fa);
}

.project-gallery {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 2rem;
  padding: 2rem;
  max-width: 1200px;
  margin: 0 auto;
}

.project-item {
  position: relative;
  aspect-ratio: 16/9;
  overflow: hidden;
  border-radius: 8px;
  cursor: pointer;
  transition: transform 0.3s ease;
  box-shadow: 0 4px 16px rgba(0,0,0,0.1);
}

.project-item:hover {
  transform: scale(1.02);
}

.project-item img,
.project-item video {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.project-thumbnail {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.text-center {
  text-align: center;
}

.mb-4 {
  margin-bottom: 2rem;
}

.projects-section h2 {
  font-size: 2.5rem;
  color: #2a7892;
  margin-bottom: 2rem;
  text-align: center;
}

@media (max-width: 768px) {
  .project-gallery {
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1rem;
    padding: 1rem;
  }
  
  .projects-section h2 {
    font-size: 2rem;
  }
}

@media (max-width: 480px) {
  .project-gallery {
    grid-template-columns: 1fr;
  }
}
</style> 